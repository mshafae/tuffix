#
# GNU Makefile for the two_shaders_glfw project
#
# Michael Shafae
# mshafae at fullerton.edu
#
# $Id: Makefile 5721 2015-04-15 22:19:46Z mshafae $
#
# It depends on the config.guess program that is in the config directory
# to guess what configuration to use for the build.
#

# which shell are we using
SHELL = /bin/sh
# some sort of uname like command and check
SYSTEM ?= $(shell config/config.guess | cut -d - -f 3 | sed -e 's/[0-9\.]//g;')
SYSTEM.SUPPORTED = $(shell test -f config/Makefile.$(SYSTEM) && echo 1)

# extra flags
CFLAGS += -DNOTEXTURE

# check if the system is supported
ifeq ($(SYSTEM.SUPPORTED), 1)
include config/Makefile.$(SYSTEM)
else
$(error "Platform '$(SYSTEM)' not supported")
endif

# project name
TARGET = hello_glsl
# C++ Files
CXXFILES =   hello_glsl.cpp glut_teapot.cpp
CFILES =  
# Headers
HEADERS =  GLFWApp.h GLSLShader.h glut_teapot.h

# create the .o version the C++ and C files without having to type them out
OBJECTS = $(CXXFILES:.cpp=.o) $(CFILES:.c=.o)

DEP = $(CXXFILES:.cpp=.d) $(CFILES:.c=.d)

# when this is called, then all the other ones below are subsequently evaluated
default all: $(TARGET)

$(TARGET): $(OBJECTS)
	$(CXX) $(LDFLAGS) -o $(TARGET) $(OBJECTS) $(LLDLIBS)

-include $(DEP)

# not too sure what .d files are used for but it seems that C++ files are being translated into this secondary file type with the same name as the C++ file.

# $< refers to the C++ files
# $@ refers to the d file being created
%.d: %.cpp
	set -e; $(CXX) -MM $(CFLAGS) $< \
	| sed 's/($*).o[ :]*/.o $@ : /g' > $@; \
	[ -s $@ ] || rm -f $@

%.d: %.c
	set -e; $(CXX) -MM $(CFLAGS) $< \
	| sed 's/($*).o[ :]*/.o $@ : /g' > $@; \
	[ -s $@ ] || rm -f $@

# compile all the C++ files in current working directory

%.o: %.cpp
	$(CXX) $(CFLAGS) -c $<

# compile all the C files in current working directory

%.o: %.c
	$(CXX) $(CFLAGS) -c $<

# first clean
clean:
	-rm -f $(OBJECTS) core $(TARGET).core *~
# second and final clean
spotless: clean
	-rm -f $(TARGET) $(DEP)
